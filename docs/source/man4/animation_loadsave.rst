.. index:: アニメーションの読み込みと保存（アニメーションプロジェクト）

#########################################
アニメーションの読み込みと保存
#########################################

.. contents::

.. index:: モーションの保存（アニメーションプロジェクト）

モーションファイルに保存する
=====================================

　一ロールだけのモーションデータをファイルに保存することができます。

1. リボンバーの ``アニメーション`` タブの ``設定`` をクリックします。

2. ``役割の管理`` タブを開きます。

3. 保存したいロールの行を選択します。

4. ツールバーの ``モーションをファイルに保存する`` をクリックします。

.. image:: img/loadsave_1.png
    :align: center

|

5. ファイル名を入力し、 ``OK`` ボタンを押します。

:保存形式:
    **.vvmmot**
    
    * 独自の拡張子ですが実際はただのJSON形式のファイルです。.jsonに拡張子を変更しても読み込むことはできます。正しくないデータを読み込んだ場合の動作は保証致しません。

.. warning::
    VRMでモーションデータを作る際、途中で身長や体格の異なるVRMに差し替えて作ると接地や各部位にズレが生じてしまいます。必ず同じVRMのままモーションの作成を完成させてください。

    例：
        1. 160cmのVRMでモーションを途中まで作り、一旦ファイルに保存する
        2. 別の日に155cmのVRMにvvmmotファイルを読み込み、モーションの続きを作成する
        3. また別の日に140cmのVRMにvvmmotファイルを読み込み、モーションを再生する
    
        この場合、3の140cmのVRMはモーション中に全身が浮き沈みしたり予期せぬ動きを起こします。

| 

.. index:: モーションの読み込み（アニメーションプロジェクト）

モーションファイルを読み込む
=================================

　モーションファイルを読み込み、アニメーションプロジェクト中の特定のロール（タイムライン）に反映させることができます。

1. リボンバーの ``アニメーション`` タブの ``設定`` をクリックします。

2. ``役割の管理`` タブを開きます。

3. 読み込ませたいロールの行を選択します。

4. ツールバーの ``モーションファイルを読み込み`` をクリックします。

.. image:: img/loadsave_2.png
    :align: center

|

5. 対象のファイルを選択すると自動的に読み込まれます。

.. note::
    * ロールの種類が同じである必要があります。
    * すでにモーションデータが存在する場合は上書きされますのでご注意ください（全部削除してから新規登録の扱い）。
    * 現在のプロジェクトの最大フレーム数より多い場合、その最大フレーム数までにカットされます。事前にある程度フレーム数を拡張しておくことをオススメします。

|

.. index:: アニメーションプロジェクトの保存（アニメーションプロジェクト）

アニメーションプロジェクトファイルを保存する
===================================================

　一通りアニメーションプロジェクトを作成したらファイルとして保存することができます。


:保存される内容:
    * タイムライン（すべてのキーフレーム含む）
    * 全ロールの情報
    * その他アニメーションプロジェクト上の設定
    * プロジェクト内の素材（実際のファイル含む）

1. リボンバーの ``アニメーション`` タブから ``保存`` をクリックします。

.. image:: img/loadsave_3.png
    :align: center

|

2.  ``保存`` あるいは ``名前を付けて保存`` をクリックします。

.. image:: img/loadsave_4.png
    :align: center

3.  ``名前をつけて保存`` の場合、入力ダイアログ上で名前を入力します。

アニメーションプロジェクトはアプリ内部の専用ストレージに保存されます。

.. note::
    * **保存** の場合、すでにプロジェクトが存在すると確認メッセージが表示されます。
    * 保存後は右上に通知メッセージが表示されます。


|


:保存形式: 
    **.vvmproj**

    ※独自の拡張子ですが実際はただのJSON形式のファイルです。.jsonに拡張子を変更しても読み込むことはできます。


.. |projopen| image:: img/loadsave_5.png


|projopen| PCや端末にダウンロードする場合は ``開く`` で内部ストレージダイアログを表示した後、ツールバーのこのボタンをクリックしてください。



|

.. index:: 
    アニメーションプロジェクトを開く（アニメーションプロジェクト）
    実際のオブジェクトの復元

アニメーションプロジェクトを開く
=================================

　保存したプロジェクトファイルを読み込むことが出来ます。

1. リボンバーの ``アニメーション`` タブから ``開く`` をクリックします。

2. 内部ストレージダイアログが開きます。

3. 対象のプロジェクトを選んだら ``OK`` ボタンを押します。

復元される内容
    * タイムライン（すべてのキーフレーム含む）
    * 全ロールの情報
    * その他アニメーションプロジェクト上の設定
    * プロジェクト内の素材（実際の素材ファイル含む）
    * キャストの実体（実際のオブジェクトファイル）


.. admonition:: 実際のオブジェクトの復元

    　各ロールに割り当てられていたキャストであるオブジェクトも可能な限り自動的に開いて復元されます。
    
    　ただし次の条件に合致するオブジェクトのみです。合致しないオブジェクトは読み込まれず、該当のロールにはどのキャストも割り当てられません。アニメーションを再生してもそのロールは動かないので、「 **ロールにキャストを割り当てる** 」の操作をする必要があります。
    
    * 基本の図形(OtherObject), Camera, Light, Effect, Text
    * アプリの履歴に保存されているオブジェクトファイル（VRM, OtherObject, Image, UImage）
    * 設定で指定されたサイズ以下のオブジェクトファイル
 

    　VRMとそれ以外のオブジェクトについては、ロールに割り当てる基準となる項目が異なります。それぞれ合致した場合は自動的に割り当てが完了し、アプリ上ですぐに操作可能になります。

    .. csv-table::
        :header-rows: 1

        種類, 基準
        VRM, VRMのタイトル
        OtherObject, ファイル名
        Image, ファイル名
        UImage, ファイル名
        上記以外, 種類に応じて自動的に

    ※ここではAudioは含みません。 

.. caution::
    これまでに開いていたプロジェクトの内容はリセットされます。


.. index:: プロジェクトを新規作成する（アニメーションプロジェクト）

プロジェクトを新規作成する
===============================


　プロジェクトを新規作成します。アプリ起動時は必要ありません。すでに開いているプロジェクトを一からやり直したい場合などに利用します。

1. リボンバーの ``アニメーション`` タブから ``新規作成`` をクリックします。


新規作成で行われること
    * アニメーションプロジェクトをすべて削除（SystemEffect、BGM、SE、Stageを除く）
    * 読み込み済みのすべてのVRoid/VRM、各オブジェクトの削除


|

.. index:: プロジェクトファイルを管理する（アニメーションプロジェクト）

プロジェクトファイルを管理する
====================================

　保存したプロジェクトファイルを内部ストレージダイアログで管理できます。

1. リボンバーの ``アニメーション`` タブから ``開く`` をクリックします。

.. image:: img/loadsave_6.png
    :align: center

|


2. 内部ストレージダイアログが開かれます。

|

ファイルから開く
---------------------

1. ツールバー上のこのボタンをクリックします。

.. image:: img/loadsave_7.png
    :align: center

|


1. 対象の拡張子 .vvmproj または .json のファイルを選択して開きます。

※正しくないデータを読み込んだ場合の動作は保証致しません。

|

名前を変更する
----------------

1. ツールバー上のこのボタンをクリックし、新しい名前を入力します。

.. image:: img/loadsave_8.png
    :align: center

|

内部ストレージから削除する
-----------------------------

1. ツールバー上のこのボタンをクリックします。

.. image:: img/loadsave_9.png
    :align: center

|

.. note::
    プロジェクトに紐づいた素材も全てアプリ内から削除されます。


.. index:: プロジェクトファイルをバックアップする（アニメーションプロジェクト）
    バックアップ
    バックアップの復元

プロジェクトファイルをバックアップする
=========================================

　現在開いているプロジェクトを、定期的にバックアップすることができます。

1. アプリの設定を開きます。
2. アプリケーションタブにある ``プロジェクトをバックアップする`` にチェックを入れます。
3. バックアップの間隔に、どのくらいの頻度でバックアップを自動的にするか目的の分を指定します。

.. image:: img/loadsave_b.png
    :align: center

4. 内部ストレージダイアログを開くと、 ``%BACKUP%`` の名称で保存されています。

.. image:: img/loadsave_c.png
    :align: center

|

.. admonition:: バックアップの作動するきっかけ

    バックアップは次の操作をすると動作の対象となり、指定の間隔で作動します。

    * フレームの最大数を変更した
    * キーフレームを登録・削除した
    * キーフレームをクリップボードから貼り付けた
    * タイムラインの内容をクリアした
    * ロールおよびタイムラインを削除した

    逆をいえば、キーフレームに登録さえしなければ古いバックアップを上書きせずに新しい操作を行い続けることができます。


　予期せぬ事態が起きてアプリが終了したり継続不可能になった場合、 ``%BACKUP%.vvmproj`` を開けば以前の状態からすぐ再開できるようになります。

.. warning::
    バックアップされたプロジェクトファイルを開いた後、改めて保存する際はファイル名を変更してください。 ``%BACKUP%`` が入ったファイル名では保存できません。

