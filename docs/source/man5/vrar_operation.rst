#####################################
VR/AR上の操作方法
#####################################

VR機器のコントローラはもちろんですが、Meta Quest 3 ではハンドトラッキングにフル対応しています。

ただし、コントローラとハンドトラッキングではデフォルトでできることが違います。

.. contents::


.. index:: 
    基本の操作(VR/AR)
    VR/ARの操作

基本の操作
#####################################

掴む:
    オブジェクトを掴んで動かします。現実のもののように移動・回転を行うことができます。

    :VR機器のコントローラ時: 
        トリガーおよびグリップ
    :ハンドトラッキング時: 
        親指と人差し指で操作したいオブジェクトをつまむ

        .. caution::
            Meta Quest 3のハンドトラッキングの場合、手のひらを自分に向けるとシステム的な操作が発動する可能性があります。なるべく手のひらをオブジェクトに向けた状態で行ってください。

    掴んで動かせるのは次のとおりです。

    * VRMの各部位のIKマーカー
    * OtherObject（の3Dモデル） **自体**
    * OtherObject, Camera, Light, Effect, Image のIKマーカー
    * 照明（Directional Light）のIKマーカー

メインカメラ移動:
    VR/AR空間の視点となっているメインカメラを動かします。通常画面のメインカメラとは視点の高さ・位置が若干ずれることがあります。

    :VR機器のコントローラ時: 
        :前後左右の移動: 左スティック
        :上下の移動: 右スティックを前・後ろに倒す
    :ハンドトラッキング時: 
        右手の仮想コントローラ

        操作対象を ``メインカメラ`` 、 操作モードを ``移動`` にしてください。

メインカメラ回転:
    VR/AR空間の視点となっているメインカメラを回転させます。

    :VR機器のコントローラ時: 
        :左を向く: 右スティックを左へ倒す
        :右を向く: 右スティックを右へ倒す

        VR機器のコントローラを使用する場合は上記以外の回転は混乱する可能性があるためできません。
        
    :ハンドトラッキング時: 
        右手の仮想コントローラ

        操作対象を ``メインカメラ`` 、 操作モードを ``回転`` にしてください。

.. note::
    * VRM全体を掴んで動かすことはできません。VRM全体を動かすには後述の仮想コントローラで操作する必要があります。
    * VR/AR空間では全てのIKマーカーが同時に表示されるようになっています。
    * VR/ARの仕様上、IKマーカーは透過表示されないためオブジェクトに隠れます。

.. index::
    仮想の手(VR/AR)
    仮想コントローラ(VR/AR)
    VR機器のコントローラ(VR/AR)

仮想コントローラ
#####################################

　基本の操作だけではできないことが多いため、VR/AR空間で特定の機能を実行できる仮想コントローラを用意しました。

これらは仮想の手の斜め下付近に表示されます。VR機器のコントローラ使用時・ハンドトラッキング時いずれも使用可能です。

.. |vrarctrl_on| image:: img/vrar_ctrl01.jpg
.. |vrarctrl_off| image:: img/vrar_ctrl02.jpg
.. |leftctrl| image:: img/vrar_ctrl03.jpg
.. |rightctrl| image:: img/vrar_ctrl04.jpg


.. csv-table:: 仮想の手

    VR機器のコントローラ使用時, ハンドトラッキング時
    |vrarctrl_on|, |vrarctrl_off|

**仮想コントローラ**

　デフォルトでは邪魔にならないように非表示になっています。 **黄色のCubeに仮想の手の指先で触れる** と仮想コントローラが表示されます。

　すべてのボタンは指先が当たり判定になっており、指先とボタンを重ねるとボタンが沈み込みます。

.. csv-table:: 仮想コントローラ
    :header-rows: 1

    左手,右手
    |leftctrl|, |rightctrl|

.. |leftctrl01| image:: img/vrar_ctrlleft_01.png
.. |leftctrl02| image:: img/vrar_ctrlleft_02.png
.. |leftctrl03| image:: img/vrar_ctrlleft_03.png
.. |leftctrl04| image:: img/vrar_ctrlleft_04.png
.. |leftctrl05| image:: img/vrar_ctrlleft_05.png
.. |leftctrl06| image:: img/vrar_ctrlleft_06.png
.. |leftctrl07| image:: img/vrar_ctrlleft_07.png
.. |leftctrl08| image:: img/vrar_ctrlleft_08.png

.. csv-table:: 左手の仮想コントローラ
    
    一番上の表示, VR/AR空間で現在選択中の3Dオブジェクトの名称です。通常画面のオブジェクトの選択とは異なります。
    |leftctrl01|, 一つ前の3Dオブジェクトを選択します。途中に2Dオブジェクトがある場合は読み飛ばします。
    |leftctrl02|, 次の3Dオブジェクトを選択します。途中に2Dオブジェクトがある場合は読み飛ばします。
    |leftctrl03|, IKマーカーの表示を切り替えます。表示がオフになっていても掴んで操作できます。通常画面のIKマーカーのON/OFFとは連動していません。
    中央の行の左の表示, 現在選択中のキーフレーム番号です。
    |leftctrl04|, 一つ前のキーフレームへ戻します。タイムラインパネルのキーフレーム操作とほぼ同じです。
    |leftctrl05|, 次のキーフレームへ戻します。タイムラインパネルのキーフレーム操作とほぼ同じです。
    |leftctrl06|, 現在選択中の3Dオブジェクトのポーズを、現在選択中のキーフレームに登録します。ここでいう **選択中** とは、あくまでもVR/AR空間上でのみ有効です。通常画面での選択とは異なります。
    |leftctrl07|, アニメーションを再生します。
    |leftctrl08|, アニメーションを停止します。

.. |rightctrl01| image:: img/vrar_ctrlright_01.png
.. |rightctrl02| image:: img/vrar_ctrlright_02.png
.. |rightctrl03| image:: img/vrar_ctrlright_03.png
.. |rightctrl04| image:: img/vrar_ctrlright_04.png
.. |rightctrl05| image:: img/vrar_ctrlright_05.png
.. |rightctrl06| image:: img/vrar_ctrlright_06.png
.. |rightctrl07| image:: img/vrar_ctrlright_07.png

.. csv-table:: 右手の仮想コントローラ

    |rightctrl01|, X軸を基準に移動および回転させます。
    |rightctrl02|, Y軸を基準に移動および回転させます。
    |rightctrl03|, Z軸を基準に移動および回転させます。
    |rightctrl04|, 操作対象を ``メインカメラ`` にします。
    |rightctrl05|, 操作対象を ``現在選択中の3Dオブジェクト`` にします。VRM全体を動かすにはこれに切り替える必要があります。
    |rightctrl06|, 操作モードを ``移動`` にします。
    |rightctrl07|, 操作モードを ``回転`` にします。

.. note::
    上記以外の操作は通常画面に戻って行ってください。

操作のまとめ
#####################################

.. csv-table::
    :header-rows: 2

        , Meta Quest 3, ,PICO4
    機能, コントローラ, ハンドトラッキング, コントローラ
    掴む, トリガーorグリップ, 人差し指+親指, トリガーorグリップ
    メインカメラ移動, 左スティック+右スティック前後, 右手の仮想コントローラ, 左スティック+右スティック前後
    メインカメラ回転, 右スティック左右, 右手の仮想コントローラ, 右スティック左右
    VRMの移動・回転, 仮想コントローラ, 仮想コントローラ, 仮想コントローラ
    VRMの各部位のIKマーカー, 掴む, 掴む, 掴む
    VRM以外の移動・回転, 掴む, 掴む, 掴む

本アプリのメインカメラとVR機器のカメラ（視点）にズレが生じた場合、各VR機器を操作して視点を中央に戻してください。

.. warning::
    PICO4のブラウザアプリでは、コントローラのBとYはブラウザの ``戻る`` に機能が割り当てられていると思われます。そのため、誤って押した場合は確認メッセージをよく見て操作してください。

.. index::
    V-pad(VR/ARの操作)

便利な操作機能
#############################

VR機器だとマウスに相当するのがコントローラです。ただしマウスと異なり細かい作業に向きません。本アプリではマウスが使えない環境でもある程度操作できるように、 ``V-pad`` という機能を用意しています。

VR機器でもそれを使えば、通常画面を操作できます。

.. image:: ../img/screen_vpad.png
    :align: center

このV-padはそれぞれの四角の中をスワイプすることによってメインカメラを移動したり回転できます。VR機器では、製品によって若干操作感が変わります。

Meta Quest 3
    * トリガーを押しながらV-pad内の四角の中をコントローラを動かすことで操作できます。
    * メインカメラの回転は両方のコントローラのトリガーを押しながらWebGL画面にフォーカスを当てると操作できます。

PICO4
    * トリガーを押しながらV-pad内の四角の中をコントローラを動かすことで操作できます。
    * V-pad内の四角の中をスティックで動かすだけで操作できます。 ``一番お勧め`` の操作方法です。
