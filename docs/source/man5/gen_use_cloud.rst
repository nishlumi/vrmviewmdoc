###############################
クラウドストレージへの対応
###############################

.. index::
    クラウドストレージへの対応
    Googleドライブへの対応


.. contents::

　ver 2.3.0より、Googleドライブに対応しました。拡張機能として実装しているので、必ずしも使う必要はありません。

　合わせて :ref:`config_fileloader` を参照してください。

対応するファイルと機能
#################################

.. csv-table::

    ファイル,Googleドライブから開く , Googleドライブに保存する
    ポーズファイル , 対応 , 対応
    モーションファイル , 対応 , 対応
    プロジェクトファイル, 対応 , 対応
    VRM , 対応 , なし
    3Dモデル , 対応 , なし
    画像 , 対応 , なし

設定画面の ``ファイルローダ`` タブでURLを入力してチェックを入れて有効化すると、リボンバーの VRM やOtherObject、ImageなどのボタンのサブメニューにGoogleドライブの項目が表示されます。

ポーズ・モーション一覧では読み込み場所のコンボボックスでGoogle Driveを選択できるようになります。

基本事項
################################

接続方法
    GoogleAppsScriptをウェブアプリ化し、発行したウェブアプリのURLを本アプリに設定してください。
    
    本アプリからユーザーのGoogleにログインすることはありません。権限の許可を求めることもしません。本アプリはそれがGoogleAppsScriptによるものなのかも判断していません。

    あくまでインプットとアウトプットが合っているかどうかです。


メリット
    * アプリ側がAPIキー、OAuth2.0情報を流出するリスクを回避できる。
    * ユーザー側が不必要なPC・端末のブラウザにまでGoogleログインする不安・リスクを回避できる。
    * ユーザーはいつでも本アプリとGoogleドライブとの接続を解除できる（再度設定する際も再ログインの手間なし）
    * APIの制限はアプリ全体ではなく、各ユーザーごとになるので制限を独り占めできる。

デメリット
    * ユーザー側でGoogleAppsScriptの作成・ウェブアプリとしての公開などいくつか準備していただく必要がある。
    * Googleドライブのスクリプトという扱いなので、通常のGoogle APIよりも制限があり、速度も遅い。

特にVR機器だと、ブラウザからGoogleにログインするのが面倒ということもありえます（二段階認証があると特に）。本アプリで導入した接続方法であれば、改めてGoogleにログインする必要がなく、ウェブアプリのURLとAPIKEYさえ自分で覚えておけばどこでも使用可能です。

Googleへのログイン履歴をきれいに保つことにも繋がるでしょう。

|

.. index::
    スクリプトの準備
    GoogleAppsScriptスクリプトプロジェクトの準備

スクリプトの準備
############################

スクリプトは下記の開発者のGoogleドライブのフォルダに置いてあります。 **(Googleにログインしている必要があります)**

スクリプトプロジェクト(GoogleAppsScript)
    :share/extensions/vrmviewmeister-gdrive-extension:
        https://drive.google.com/drive/folders/1QkWCH0GfKHIQLgbT5Ir-U-mBEKAE3AJy?usp=drive_link

    これを自分のドライブにコピーするのが一番簡単です。コピーした後はどのフォルダに移動しても問題ありません。

    .. warning::
        上記サンプルプロジェクト内のスクリプトを直接実行しないでください。ユーザーのGoogleへのアクセス権限の許可を求めてしまいます。

        必ず自分のGoogleドライブにコピーしたスクリプトプロジェクトを使ってください。


    インストール手順は下記を参考にしてください。

    :Googleスライドによるインストール方法 - Googleスライド:
        https://docs.google.com/presentation/d/e/2PACX-1vQP2RstLGn82dh_FOqBfbPPBGvx9o-YQXc-3ol8Gk4_IseKrzsgs0hgAt0h4uYX2kA71ENrnI-XXbBf/pub?start=false&loop=false&delayms=3000&slide=id.p
    :インストール方法 - Github:
        https://github.com/nishlumi/vrmviewmeister-gdrive-extension/blob/main/install.rst

|

Github
    下記リポジトリでもソースを公開していますので、何をしているか参考にしてください。

    :vrmviewmeister-gdrive-extension - Github:
        https://github.com/nishlumi/vrmviewmeister-gdrive-extension/

|

やるべきこと 
    1. GoogleAppsScriptでウェブアプリを作成する
    2. 本アプリで使用する前にスクリプトプロジェクトのテスト関数を実行し、Googleに自分のドライブへのアクセス権限を許可する
    3. 自分でAPIKEYを決める
    4. デプロイして、ウェブアプリのURLをコピーする

    .. hint::
        一般的にGoogle APIを使うウェブサービスだと2の操作が、そのサービスからGoogleにログインを求められる操作に相当します。

        本アプリにおいては事前にスクリプトプロジェクト内で自分で行っていただくので、本アプリを使う上でGoogleへログインする手間は不要です。

.. index::
    スクリプトのアップデート

スクリプトのアップデート
################################

今後上記スクリプトプロジェクトを更新することがあります。その場合は次のページの手順を実施してください。

:インストール方法 - Github:
    https://github.com/nishlumi/vrmviewmeister-gdrive-extension/blob/main/install.rst

やるべきこと
    1. 更新後のスクリプトを自分のスクリプトプロジェクトにまるごと貼り付ける
    2. 再びデプロイして、ウェブアプリのURLを新規に発行する
    3. VRMViewMeisterに再発行後のURLを設定する
    4. 過去にデプロイした古いウェブアプリのURLをアーカイブして停止する。（任意）


使用方法
############################

リボンバー
    ホームタブ:
        VRM, オブジェクト, プロジェクトの開くメニューで次の機能を使えます。

        ``Googleドライブから直接指定``
            GoogleドライブのファイルIDを直接指定して開きます。

            .. caution::
                該当のファイルを一般公開あるいは自分のGoogleユーザーに共有されている必要があります。
        
        ``Googleドライブから選択``
            Googleドライブからそれぞれのファイルタイプで抽出して一覧を表示します。内部ストレージダイアログが開きます。
        
        プロジェクトの保存メニューでGoogleドライブへの保存を行うことが出来ます。

    3Dモデルタブ:
        VRM, オブジェクト, 画像で上記の機能を使えます。

        * ``Googleドライブから直接指定``
        * ``Googleドライブから選択``

        Pose/Motionの保存メニューでGoogleドライブへの保存を行うことが出来ます。
    
    アニメーションタブ:
        プロジェクトの開くメニューで次の機能を使えます。

        ``Googleドライブから選択``

        プロジェクトの保存メニューでGoogleドライブへの保存を行うことが出来ます。

ポーズ・モーション一覧
    読み込み場所:
        ``Google Drive`` を選択可能になります。

